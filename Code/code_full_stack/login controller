package org.MY_APP.User_Interface;

import javafx.fxml.FXML;
import javafx.scene.control.*;
import org.MY_APP.Database.UserRepository;
import org.MY_APP.Model.User;

public class LoginController {

    @FXML private TextField usernameField;
    @FXML private PasswordField passwordField;
    @FXML private Label messageLabel;

    private UserRepository userRepository;
    private Runnable onLoginSuccess;
    private Runnable onSignupRequest;

    public void setUserRepository(UserRepository repo) {
        this.userRepository = repo;
    }

    public void setOnLoginSuccess(Runnable callback) {
        this.onLoginSuccess = callback;
    }

    public void setOnSignupRequest(Runnable callback) {
        this.onSignupRequest = callback;
    }

    @FXML
    private void initialize() {
        messageLabel.setText("");
    }

    @FXML
    private void onLoginClick() {

        String user = usernameField.getText().trim();
        String pass = passwordField.getText().trim();

        if (user.isEmpty() || pass.isEmpty()) {
            messageLabel.setText("⚠ Fill all fields.");
            return;
        }

        User found = userRepository.getUser(user);

        if (found == null) {
            messageLabel.setText("❌ User does not exist.");
            return;
        }

        if (!found.getPassword().equals(pass)) {
            messageLabel.setText("❌ Wrong password.");
            return;
        }

        messageLabel.setText("✔ Login successful!");

        onLoginSuccess.run();
    }

    @FXML
    private void onSignupClick() {
        if (onSignupRequest != null) {
            onSignupRequest.run();
        }
    }
}
